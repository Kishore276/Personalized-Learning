<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Dashboard - Personalized Learning</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
        <style>
            body { background: #f4f6fb; }
            .dashboard-container { max-width: 1200px; margin: 0 auto; padding: 2rem 0; }
            .card { border-radius: 1rem; box-shadow: 0 2px 12px rgba(0,0,0,0.08); }
            .card-header { border-radius: 1rem 1rem 0 0; font-weight: 600; font-size: 1.1rem; }
            .btn-primary { background: linear-gradient(90deg, #007bff 60%, #00c6ff 100%); border: none; }
            .btn-success { background: linear-gradient(90deg, #28a745 60%, #85e085 100%); border: none; }
            .btn-warning { background: linear-gradient(90deg, #ffc107 60%, #ffe082 100%); border: none; color: #212529; }
            .card-title { color: #007bff; }
            .card-ongoing { border-left: 6px solid #28a745; }
            .card-available { border-left: 6px solid #007bff; }
            .card-user { border-left: 6px solid #ffc107; }
            .bg-gradient { background: linear-gradient(90deg, #e3f2fd 60%, #fce4ec 100%); }
            .dashboard-title-available { color:#007bff; letter-spacing:1px; }
            .dashboard-title-ongoing { color:#28a745; letter-spacing:1px; }
            .dashboard-title-your { color:#ffc107; letter-spacing:1px; }
            .progress-custom-height { height: 8px; }
        </style>
</head>
<body>
        <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm mb-4">
            <div class="container-fluid">
                <a class="navbar-brand fw-bold fs-4" href="#">
                    <i class="bi bi-mortarboard"></i> Personalized Learning
                </a>
                <div class="d-flex align-items-center gap-3">
                    <span class="text-secondary"><i class="bi bi-person-circle me-2"></i>Welcome, {{ username }}</span>
                    <a href="{{ url_for('logout') }}" class="btn btn-outline-secondary btn-sm rounded-pill">
                        <i class="bi bi-box-arrow-right me-2"></i>Logout
                    </a>
                </div>
            </div>
        </nav>
    <!-- Modern Dashboard UI -->
        <div class="dashboard-container">
            <div class="row">
                <!-- Left Column: Available & Ongoing Courses -->
                <div class="col-lg-7 mb-4">
                    <!-- Available Courses -->
                    <h2 class="mb-4 text-center fw-bold dashboard-title-available">
                        <i class="bi bi-book me-2"></i>Available Courses
                    </h2>
                    <div class="row g-4 justify-content-center">
                        {% for course in available_courses %}
                        <div class="col-md-6 col-lg-4 d-flex align-items-stretch">
                            <div class="card h-100 border-primary shadow-sm">
                                <div class="card-header bg-primary text-white text-center fw-bold fs-5">
                                    <i class="bi bi-book-half me-2"></i>{{ course['title'] }}
                                </div>
                                <div class="card-body d-flex flex-column">
                                    <p class="card-text text-muted mb-3">{{ course['description'] }}</p>
                                    <a href="/start_course/{{ course['id'] }}" class="btn btn-primary mt-auto rounded-pill px-4 py-2">
                                        <i class="bi bi-play-circle me-2"></i>Start Course
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <!-- Ongoing Courses -->
                    {% if ongoing_courses %}
                    <h2 class="mb-4 text-center fw-bold dashboard-title-ongoing">
                        <i class="bi bi-arrow-repeat me-2"></i>Ongoing Courses
                    </h2>
                    <div class="row g-4 justify-content-center">
                        {% for course in ongoing_courses %}
                        <div class="col-md-6 col-lg-4 d-flex align-items-stretch">
                            <div class="card h-100 border-success shadow-sm">
                                <div class="card-header bg-success text-white text-center fw-bold fs-5">
                                    <i class="bi bi-arrow-repeat me-2"></i>{{ course['title'] }}
                                </div>
                                <div class="card-body d-flex flex-column">
                                    <p class="card-text text-muted mb-3">{{ course['description'][:100] }}{% if course['description']|length > 100 %}...{% endif %}</p>
                                    {% if course.progress %}
                                    <div class="mb-2">
                                        <div class="d-flex justify-content-between align-items-center mb-1">
                                            <span class="small text-secondary">Progress</span>
                                            <span class="small text-secondary">{{ "%.1f"|format(course.progress.percentage) }}%</span>
                                        </div>
                                        <div class="progress progress-custom-height">
                                            <div class="progress-bar bg-success" role="progressbar" aria-valuemin="0" aria-valuemax="100" title="Progress: {{ '%.1f'|format(course.progress.percentage) }}%" data-progress="{{ course.progress.percentage }}"></div>
                                        </div>
                                        <span class="small text-secondary">{{ course.progress.completed_topics }}/{{ course.progress.total_topics }} topics completed</span>
                                    </div>
                                    {% endif %}
                                    <a href="/start_course/{{ course['id'] }}" class="btn btn-success w-100 mt-2 rounded-pill px-4 py-2">
                                        <i class="bi bi-arrow-right-circle me-2"></i>{% if course.progress and course.progress.status == 'completed' %}Review Course{% else %}Continue Learning{% endif %}
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                <!-- Right Column: Enhanced Quiz & Emotion Detection -->
                <div class="col-lg-5 mb-4">
                    <!-- Enhanced Quiz Card -->
                    <div class="card border-warning shadow-sm mb-4">
                        <div class="card-header bg-warning text-dark fw-bold">
                            <i class="bi bi-brain"></i> Enhanced Quiz System
                        </div>
                        <div class="card-body">
                            <p>Test your programming knowledge with our comprehensive quiz system:</p>
                            <ul class="list-unstyled mb-3">
                                <li><i class="bi bi-check-circle text-success me-2"></i>Topic-wise questions</li>
                                <li><i class="bi bi-check-circle text-success me-2"></i>Course-specific quizzes</li>
                                <li><i class="bi bi-check-circle text-success me-2"></i>Multiple difficulty levels</li>
                                <li><i class="bi bi-check-circle text-success me-2"></i>Detailed explanations</li>
                            </ul>
                            <button id="quizTriggerBtnRight" class="btn btn-warning w-100 rounded-pill">
                                <i class="bi bi-mortarboard me-2"></i>Take Personalized Quiz
                            </button>
                        </div>
                    </div>
                    <!-- Concentration Detection Card -->
                    <div class="card border-info shadow-sm mb-4">
                        <div class="card-header bg-info text-white fw-bold d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-camera-video"></i> Concentration Detection</span>
                        </div>
                        <div class="card-body">
                            <div class="d-flex flex-column align-items-center gap-3">
                                <div class="emotion-video-container mb-3" style="position:relative; text-align:center;">
                                    <video id="videoInput" width="320" height="240" autoplay muted style="border-radius:10px;box-shadow:0 2px 8px #ccc;"></video>
                                    <!-- Face detection overlay canvas -->
                                    <canvas id="faceDetectionCanvas" width="320" height="240" style="position:absolute; top:0; left:0; pointer-events:none; border-radius:10px;"></canvas>
                                </div>
                                <div id="concentration-status" class="badge bg-info-subtle text-info-emphasis py-2 px-3 mb-2" aria-live="polite">
                                    Concentration detection active.
                                </div>
                                <div id="face-count-status" class="badge bg-secondary text-white py-1 px-2" style="font-size:0.8rem;">
                                    Faces detected: 0
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@21stdev/ui/dist/21stdev-ui.min.js"></script>
    <script src="{{ url_for('static', filename='js/webcam_hybrid.js') }}"></script>
    <script>
    const quizBtn = document.getElementById('quizTriggerBtnRight');
    if (quizBtn) {
        quizBtn.addEventListener('click', function() {
            window.location.href = '/quiz_page';
        });
    }
    </script>
    {% include 'quiz_modal.html' %}
</body>
</html>
